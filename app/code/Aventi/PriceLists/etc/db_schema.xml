<?xml version="1.0" ?>
<schema xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Setup/Declaration/Schema/etc/schema.xsd">
    <table name="avpricelists_pricelist" resource="default" engine="innodb" comment="Pricelist Table">
        <column xsi:type="bigint" name="entity_id" unsigned="true" nullable="false" identity="true" comment="Entity Id"/>
        <column name="name" nullable="true" xsi:type="varchar" comment="Price list name" length="50"/>
        <column name="description" nullable="false" xsi:type="varchar" comment="Price list description" length="255"/>
        <constraint xsi:type="primary" referenceId="pk_avpricelists_pricelist">
            <column name="entity_id"/>
        </constraint>
        <index referenceId="avpricelists_pricelist_name_index" indexType="btree">
            <column name="name"/>
        </index>
    </table>
    <table name="avpricelists_customers" comment="Pricelist customers table" engine="innodb" resource="default">
        <column comment="Entity Id" identity="true" name="entity_id" nullable="false" unsigned="false" xsi:type="bigint"/>
        <column name="price_list_id" nullable="false" unsigned="true" xsi:type="bigint"/>
        <column name="customer_id" nullable="false" unsigned="true" xsi:type="int"/>
        <constraint referenceId="pk_avpricelists_customers" xsi:type="primary">
            <column name="entity_id"/>
            <column name="price_list_id"/>
            <column name="customer_id"/>
        </constraint>
        <constraint xsi:type="foreign" referenceId="fk_avpricelists_customers_avpricelists_pricelist_price_list_id"
                    table="avpricelists_customers"
                    column="price_list_id"
                    referenceTable="avpricelists_pricelist"
                    referenceColumn="entity_id"
                    onDelete="CASCADE"
        />
        <constraint xsi:type="foreign" referenceId="fk_avpricelists_customers_customer_entity_entity_id"
                    table="avpricelists_customers"
                    column="customer_id"
                    referenceTable="customer_entity"
                    referenceColumn="entity_id"
                    onDelete="CASCADE"
        />
        <constraint xsi:type="unique" referenceId="uc_avpricelists_customers">
            <column name="customer_id"/>
            <column name="price_list_id"/>
        </constraint>
        <index referenceId="avpricelists_customers_pricelist_id_index" indexType="btree">
            <column name="price_list_id"/>
        </index>
        <index referenceId="avpricelists_customers_customer_id_index" indexType="btree">
            <column name="customer_id"/>
        </index>
    </table>
    <table  name="avpricelists_products" comment="Pricelists products table" engine="innodb" resource="default">
        <column comment="Entity Id" identity="true" name="entity_id" nullable="false" unsigned="false" xsi:type="bigint"/>
        <column name="price_list_id" nullable="false" unsigned="true" xsi:type="bigint"/>
        <column name="product_id" nullable="false" unsigned="true" xsi:type="int"/>
        <column name="product_price" nullable="false" xsi:type="decimal" scale="2"/>
        <column name="product_price_sug" nullable="false" xsi:type="decimal" scale="2"/>
        <column name="product_rule_type" nullable="false" default="price" xsi:type="varchar" length="8" comment="price/discount"/>
        <constraint referenceId="pk_avpricelists_products" xsi:type="primary">
            <column name="entity_id"/>
            <column name="price_list_id"/>
            <column name="product_id"/>
        </constraint>
        <constraint xsi:type="foreign" referenceId="fk_avpricelists_products_avpricelists_pricelist_price_list_id"
                    table="avpricelists_products"
                    column="price_list_id"
                    referenceTable="avpricelists_pricelist"
                    referenceColumn="entity_id"
                    onDelete="CASCADE"
        />
        <constraint xsi:type="foreign" referenceId="fk_avpricelists_products_catalog_product_entity_entity_id"
                    table="avpricelists_products"
                    column="product_id"
                    referenceTable="catalog_product_entity"
                    referenceColumn="entity_id"
                    onDelete="CASCADE"
        />
        <constraint xsi:type="unique" referenceId="uc_avpricelists_products">
            <column name="product_id"/>
            <column name="price_list_id"/>
        </constraint>
        <index referenceId="avpricelists_products_pricelist_id_index" indexType="btree">
            <column name="price_list_id"/>
        </index>
        <index referenceId="avpricelists_products_product_id_index" indexType="btree">
            <column name="product_id"/>
        </index>
    </table>
    <table name="avpricelists_category" comment="Pricelists category table" engine="innodb" resource="default">
        <column comment="Entity Id" identity="true" name="entity_id" nullable="false" unsigned="false" xsi:type="bigint"/>
        <column name="price_list_id" nullable="false" unsigned="true" xsi:type="bigint"/>
        <column name="category_id" nullable="false" unsigned="true" xsi:type="int"/>
        <column name="category_price" nullable="false" xsi:type="decimal" scale="2"/>
        <column name="category_rule_type" nullable="false" default="price" xsi:type="varchar" length="8" comment="price/discount"/>
        <constraint referenceId="pk_avpricelists_category" xsi:type="primary">
            <column name="entity_id"/>
            <column name="price_list_id"/>
            <column name="category_id"/>
        </constraint>
        <constraint xsi:type="foreign" referenceId="fk_avpricelists_category_avpricelists_pricelist_price_list_id"
                    table="avpricelists_category"
                    column="price_list_id"
                    referenceTable="avpricelists_pricelist"
                    referenceColumn="entity_id"
                    onDelete="CASCADE"
        />
        <constraint xsi:type="foreign" referenceId="fk_avpricelists_category_catalog_category_entity_entity_id"
                    table="avpricelists_category"
                    column="category_id"
                    referenceTable="catalog_category_entity"
                    referenceColumn="entity_id"
                    onDelete="CASCADE"
        />
        <constraint xsi:type="unique" referenceId="uc_avpricelists_category">
            <column name="category_id"/>
            <column name="price_list_id"/>
        </constraint>
        <index referenceId="avpricelists_category_pricelist_id_index" indexType="btree">
            <column name="price_list_id"/>
        </index>
        <index referenceId="avpricelists_category_category_id_index" indexType="btree">
            <column name="category_id"/>
        </index>
    </table>

    <table name="avpricelists_customergroups" comment="PriceList customergroups table" engine="innodb" resource="default">
        <column comment="Entity Id" identity="true" name="entity_id" nullable="false" unsigned="false" xsi:type="bigint"/>
        <column name="price_list_id" nullable="false" unsigned="true" xsi:type="bigint"/>
        <column name="customer_group_id" nullable="false" unsigned="true" xsi:type="int"/>
        <constraint referenceId="pk_avpricelists_customergroups" xsi:type="primary">
            <column name="entity_id"/>
            <column name="price_list_id"/>
            <column name="customer_group_id"/>
        </constraint>
        <!--<constraint xsi:type="foreign" referenceId="fk_avpricelists_customergroups_avpricelists_pricelist_price_list_id"
                    table="avpricelists_customergroups"
                    column="price_list_id"
                    referenceTable="avpricelists_pricelist"
                    referenceColumn="entity_id"
                    onDelete="CASCADE"
        />-->
        <constraint xsi:type="foreign" referenceId="fk_avpricelists_customergroups_customer_group_customergroupid"
                    table="avpricelists_customergroups"
                    column="customer_group_id"
                    referenceTable="customer_group"
                    referenceColumn="customer_group_id"
                    onDelete="CASCADE"
        />
        <index referenceId="avpricelists_customersgroups_pricelist_id_index" indexType="btree">
            <column name="price_list_id"/>
        </index>
        <index referenceId="avpricelists_customers_customer_group_id_index" indexType="btree">
            <column name="customer_group_id"/>
        </index>
    </table>
</schema>
